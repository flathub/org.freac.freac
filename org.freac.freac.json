{
    "app-id": "org.freac.freac",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "24.08",
    "sdk": "org.freedesktop.Sdk",
    "command": "freac",
    "finish-args": [
        "--device=all",
        "--filesystem=host",
        "--share=ipc",
        "--share=network",
        "--socket=pulseaudio",
        "--socket=x11",
        "--metadata=X-DConf=migrate-path=/org/freac/freac/"
    ],
    "cleanup": [
        "/bin/mac",
        "/include",
        "/lib/pkgconfig",
        "/share/aclocal",
        "/share/info",
        "/share/man",
        "*.a",
        "*.la"
    ],
    "modules": [
        "shared-modules/mac/mac.json",
        {
            "name": "libcdio",
            "config-opts": [
                "--disable-cxx",
                "--disable-example-progs",
                "--without-cd-drive",
                "--without-cd-info",
                "--without-cd-read",
                "--without-cdda-player",
                "--without-iso-info",
                "--without-iso-read"
            ],
            "cleanup": [
                "/bin/mmc-tool",
                "/lib/libiso9660.*",
                "/lib/libudf.*"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/libcdio/libcdio/archive/refs/tags/2.2.0.tar.gz",
                    "sha256": "df007a9b9667797e027e573822cc865e5e106352f8a6fbca67ee8e9e7a1e5b51",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 1573,
                        "url-template": "https://github.com/libcdio/libcdio/archive/refs/tags/$version.tar.gz"
                    }
                }
            ]
        },
        {
            "name": "libcdio-paranoia",
            "config-opts": [
                "--disable-cxx",
                "--disable-example-progs"
            ],
            "cleanup": [
                "/bin/cd-paranoia"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/libcdio/libcdio-paranoia/archive/refs/tags/release-10.2+2.0.2.tar.gz",
                    "sha256": "fe35208811f3edfcb79ae7b4ad1984f3188aea42c4c8ba4d009efafb36734a8b",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 21751,
                        "url-template": "https://github.com/libcdio/libcdio-paranoia/archive/refs/tags/release-10.2+$version.tar.gz"
                    }
                }
            ]
        },
        {
            "name": "libmp3lame",
            "//": "Performance-enhancing patch, not part of runtime libmp3lame",
            "config-opts": [
                 "--enable-nasm",
                 "--disable-frontend"
            ],
            "cleanup": [
                "/share/doc/lame"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://sourceforge.net/projects/lame/files/lame/3.100/lame-3.100.tar.gz",
                    "sha256": "ddfe36cab873794038ae2c1210557ad34857a4b6bdc515785d1da9e175b1da1e",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 12523,
                        "url-template": "https://sourceforge.net/projects/lame/files/lame/$version/lame-$version.tar.gz"
                    }
                },
                {
                    "only-arches": [ "x86_64" ],
                    "type": "patch",
                    "path": "patches/lame-3.100-sse-20171014.patch",
                    "strip-components": 0                    
                }
            ]
        },
        {
            "name": "libmp4v2",
            "cleanup": [
                "/bin/mp4*"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/enzo1982/mp4v2/releases/download/v2.1.3/mp4v2-2.1.3.tar.bz2",
                    "sha256": "033185c17bf3c5fdd94020c95f8325be2e5356558e3913c3d6547a85dd61f7f1",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 98413,
                        "url-template": "https://github.com/enzo1982/mp4v2/releases/download/v$version/mp4v2-$version.tar.bz2"
                    }
                }
            ]
        },
        {
            "name": "liburiparser",
            "buildsystem": "cmake",
            "config-opts": [
                "-DURIPARSER_BUILD_DOCS=OFF",
                "-DURIPARSER_BUILD_TESTS=OFF"
            ],
            "cleanup": [
                "/bin/uriparse"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/uriparser/uriparser/releases/download/uriparser-0.9.8/uriparser-0.9.8.tar.xz",
                    "sha256": "1d71c054837ea32a31e462bce5a1af272379ecf511e33448e88100b87ff73b2e",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 10160,
                        "url-template": "https://github.com/uriparser/uriparser/releases/download/uriparser-$version/uriparser-$version.tar.xz"
                    }
                }
            ]
        },
        {
            "name": "libvorbis",
            "//": "Performance-enhancing patches, not part of runtime libvorbis",
            "cleanup": [
                "/share/doc/libvorbis*"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://downloads.xiph.org/releases/vorbis/libvorbis-1.3.7.tar.xz",
                    "sha256": "b33cc4934322bcbf6efcbacf49e3ca01aadbea4114ec9589d1b1e9d20f72954b",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 1758,
                        "url-template": "https://downloads.xiph.org/releases/vorbis/libvorbis-$version.tar.xz"
                    }
                },
                {
                    "type": "patch",
                    "path": "patches/libvorbis-1.3.7-aotuv-b6.03.patch"
                },
                {
                    "only-arches": [ "x86_64" ],
                    "type": "patch",
                    "path": "patches/libvorbis-1.3.7-aotuv-b6.03-lancer.patch"
                }
            ]
        },
        {
            "name": "musepack",
            "build-options": {
                "cflags": "-Wno-incompatible-pointer-types"
            },
            "config-opts": [
                "--disable-shared"
            ],
            "cleanup": [
                "/bin/mpc2sv8",
                "/bin/mpccut",
                "/bin/wavcmp"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.musepack.net/source/musepack_src_r475.tar.gz",
                    "sha256": "a4b1742f997f83e1056142d556a8c20845ba764b70365ff9ccf2e3f81c427b2b",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 21865,
                        "url-template": "https://files.musepack.net/source/musepack_src_r$version.tar.gz"
                    }
                },
                {
                    "type": "patch",
                    "path": "patches/musepack_src_r475-const.patch"
                },
                {
                    "type": "shell",
                    "commands": [
                        "touch include/config.h.in",
                        "head -n 34 configure.in >> configure.ac",
                        "echo \"AM_CONDITIONAL([HAVE_VISIBILITY], [false])\" >> configure.ac",
                        "echo \"AC_CHECK_LIB([m],[cos])\" >> configure.ac",
                        "tail -n 18 configure.in >> configure.ac",
                        "rm configure.in",
                        "autoreconf -i"
                    ]
                }
            ]
        },
        {
            "name": "rnnoise",
            "cleanup": [
                "/share/doc/rnnoise"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://gitlab.xiph.org/xiph/rnnoise.git",
                    "tag": "v0.2",
                    "commit": "904a876dce1f9ab8860c0a5000ed151f9f6eef58",
                    "x-checker-data": {
                        "type": "git",
                        "tag-pattern": "^v([\\d.]+)$"
                    }
                },
                {
                    "type": "patch",
                    "path": "patches/rnnoise-fix-arm64-build.patch"

                },
                {
                    "type": "file",
                    "url": "https://media.xiph.org/rnnoise/models/rnnoise_data-0b50c45.tar.gz",
                    "sha256": "4ac81c5c0884ec4bd5907026aaae16209b7b76cd9d7f71af582094a2f98f4b43",
                    "//": "Add manually according to download_model.sh"
                }
            ]
        },
        {
            "name": "rubberband",
            "build-options": {
                "env": { "Vamp_CFLAGS": " ", "Vamp_LIBS": " " }
            },
            "sources": [
                {
                    "type": "archive",
                    "url": "https://breakfastquay.com/files/releases/rubberband-1.8.2.tar.bz2",
                    "sha256": "86bed06b7115b64441d32ae53634fcc0539a50b9b648ef87443f936782f6c3ca",
                    "//": "Stay at v1.8.2 because of switched flags in versions >= 1.9"
                },
                {
                    "type": "shell",
                    "commands": [
                        "sed -i -e \"s/^all\\:.*/all: bin lib \\$\\(DYNAMIC_TARGET\\)/\" Makefile.in",
                        "head -n 169 Makefile.in >> Makefile.in.temp",
                        "head -n 172 Makefile.in | tail -n 1 >> Makefile.in.temp",
                        "head -n 185 Makefile.in | tail -n 6 >> Makefile.in.temp",
                        "tail -n 100 Makefile.in >> Makefile.in.temp",
                        "mv Makefile.in.temp Makefile.in"
                    ]
                }
            ]
        },
        {
            "name": "smooth",
            "no-autogen": true,
            "make-install-args": [ "prefix=/app" ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/enzo1982/smooth/releases/download/v0.9.10/smooth-0.9.10.tar.gz",
                    "sha256": "c018ea09eb4e269268cb123bb5d24a813d07c985384c5384d7fa73b7173e9f1c",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 84187,
                        "url-template": "https://github.com/enzo1982/smooth/releases/download/v$version/smooth-$version.tar.gz"
                    }
                }
            ]
        },
        {
            "name": "BoCA",
            "no-autogen": true,
            "make-install-args": [ "prefix=/app" ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/enzo1982/BoCA/releases/download/v1.0.7/boca-1.0.7.tar.gz",
                    "sha256": "2433f2752e1441f6270460f5f2acb99de67b269e494559134e3ab26173222c7e",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 371335,
                        "url-template": "https://github.com/enzo1982/BoCA/releases/download/v$version/boca-$version.tar.gz"
                    }
                }
            ]
        },
        {
            "name": "freac",
            "no-autogen": true,
            "make-install-args": [ "prefix=/app" ],
            "build-options": {
                "cxxflags": "-DFREAC_DATE=\\\"20230305\\\""
            },
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/enzo1982/freac/releases/download/v1.1.7/freac-1.1.7.tar.gz",
                    "sha256": "617d51759315f65e387fcaf1f1b455c97a2fb53bfdbd2521c9c586b3271f3528",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 371355,
                        "url-template": "https://github.com/enzo1982/freac/releases/download/v$version/freac-$version.tar.gz"
                    }
                },
                {
                    "type": "patch",
                    "path": "patches/freac-1.1-beta-noudev.patch"
                },
                {
                    "type": "patch",
                    "path": "patches/appstream.patch"
                }
            ]
        }
    ]
}
